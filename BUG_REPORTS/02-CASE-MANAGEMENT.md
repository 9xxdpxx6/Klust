# Баги: Управление кейсами

## BUG-005: Проблемы с редиректом и отображением после создания кейса (партнер)

**Приоритет**: Critical  
**Модуль**: Управление кейсами / Партнерский портал

### Описание
После создания кейса партнером:
1. Система не выполняет автоматический редирект (или редирект работает некорректно)
2. При ручном переходе на `/partner/dashboard` боковая панель не работает
3. Ничего не отображается (белая страница)
4. После обновления страницы в URL появляется ссылка с нужным кейсом, но страница все равно белая и ничего не показывает

### Шаги для воспроизведения
1. Авторизоваться как партнер
2. Перейти в раздел создания кейса (`/partner/cases/create`)
3. Заполнить форму создания кейса
4. Нажать "Опубликовать" или "Сохранить как черновик"
5. Наблюдать за поведением после отправки формы

### Ожидаемое поведение
- После создания кейса должен произойти редирект на страницу просмотра созданного кейса (`/partner/cases/{id}`)
- Страница должна корректно отображаться
- Боковая панель должна работать
- Все данные кейса должны быть видны

### Фактическое поведение
- Редирект не происходит автоматически (или работает некорректно)
- При ручном переходе на `/partner/dashboard` боковая панель не работает
- Отображается белая страница
- После обновления страницы в URL есть правильная ссылка, но страница все равно белая

### Файлы для проверки
- `app/Http/Controllers/Client/Partner/CasesController.php` (метод `store`, строки 121-150)
- `resources/js/Pages/Client/Partner/Cases/Create.vue` (метод `submitForm`, строки 226-245)
- `resources/js/Pages/Client/Partner/Cases/Show.vue`
- `resources/js/Layouts/PartnerLayout.vue`
- `resources/js/Layouts/ClientLayoutWithSidebar.vue`
- Консоль браузера (JavaScript ошибки)
- Network tab (ответы сервера)

### Предполагаемая причина

**ЧАСТИЧНО ИСПРАВЛЕНО**: В `Create.vue` были убраны `preserveState` и `preserveScroll` (строки 236-244), но проблема может оставаться.

1. **Возможные ошибки JavaScript** на странице `Show.vue`:
   - Ошибки в обработке данных кейса
   - Проблемы с компонентами на странице
   - Ошибки в props или структуре данных
   - Проблемы с компонентами из PrimeVue

2. **Проблемы с layout**:
   - Ошибка в `PartnerLayout.vue` или `ClientLayoutWithSidebar.vue`
   - Проблема с инициализацией sidebar
   - Проблемы с загрузкой компонентов layout

3. **Проблемы с данными**:
   - Некорректная структура данных, передаваемых в `Show.vue`
   - Отсутствие обязательных данных в props
   - Проблемы с отношениями в модели CaseModel

### Решение

1. **Проверить консоль браузера** на наличие JavaScript ошибок при открытии страницы `Show.vue`:
   - Открыть DevTools (F12)
   - Перейти на вкладку Console
   - Проверить наличие ошибок

2. **Проверить структуру данных**, передаваемых в `Show.vue`:
   - Убедиться, что все необходимые данные загружаются в контроллере
   - Проверить типы данных в props компонента
   - Проверить наличие всех связей (relationships) в CaseModel

3. **Проверить layout**:
   - Убедиться, что `PartnerLayout.vue` корректно использует `ClientLayoutWithSidebar`
   - Проверить инициализацию sidebar
   - Проверить, что все компоненты layout загружаются корректно

4. **Добавить обработку ошибок** в компоненте `Show.vue` для отображения ошибок, если они есть

5. **Проверить Network tab**:
   - Проверить статус ответа сервера
   - Проверить тело ответа (что именно возвращает сервер)
   - Проверить, правильно ли работает route `partner.cases.show`

### Дополнительные проверки

1. Проверить Network tab - какой статус возвращает сервер
2. Проверить Response - что именно возвращает сервер (структуру данных)
3. Проверить, правильно ли работает route `partner.cases.show`
4. Проверить, авторизован ли пользователь после редиректа
5. Проверить логи Laravel на наличие ошибок при загрузке страницы
