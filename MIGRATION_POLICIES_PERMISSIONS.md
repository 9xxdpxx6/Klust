# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ —Å —Ä–æ–ª–µ–π –Ω–∞ Policy –∏ –ø—Ä–∞–≤–∞

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–æ–ª–µ–π –Ω–∞ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
- **–†–æ–ª–∏** - –¥–ª—è —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–æ–≤ (–æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å)
- **–ü—Ä–∞–≤–∞ (Permissions)** - –¥–ª—è –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–µ–π—Å—Ç–≤–∏–π
- **Policy** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–º –∏ —Å–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

### –†–æ–ª–∏ (–æ—Å—Ç–∞–≤–∏—Ç—å)
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤/–ø–æ—Ä—Ç–∞–ª–æ–≤:
- `role:admin|teacher` - –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- `role:student` - –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–º—É –ø–æ—Ä—Ç–∞–ª—É
- `role:partner` - –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–º—É –ø–æ—Ä—Ç–∞–ª—É

### –ü—Ä–∞–≤–∞ (–ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å)
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º:
- `permission:users.delete` - –ø—Ä–∞–≤–æ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `permission:cases.create` - –ø—Ä–∞–≤–æ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–µ–π—Å–æ–≤
- `permission:cases.approve` - –ø—Ä–∞–≤–æ –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫

### Policy (–ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å)
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–º –∏ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏:
- –ü–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–µ–π—Å—ã
- –°—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç –æ—Ç–æ–∑–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∑–∞—è–≤–∫—É
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è 1: –û—Å—Ç–∞–≤–∏—Ç—å —Å —Ä–æ–ª—è–º–∏ (—Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª–æ–≤)

–≠—Ç–∏ –º–µ—Å—Ç–∞ **–ù–ï –¢–†–û–ì–ê–¢–¨** - —Ä–æ–ª–∏ –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

### –ú–∞—Ä—à—Ä—É—Ç—ã (routes/web.php)

```php
// ‚úÖ –û–°–¢–ê–í–ò–¢–¨ - —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª–æ–≤
Route::prefix('admin')->middleware(['auth', 'role:admin|teacher'])
Route::prefix('student')->middleware('role:student')
Route::prefix('partner')->middleware('role:partner')
```

**–§–∞–π–ª:** `routes/web.php`
- –°—Ç—Ä–æ–∫–∏: 94, 128, 162
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –†–µ–¥–∏—Ä–µ–∫—Ç—ã –ø–æ —Ä–æ–ª—è–º

**–§–∞–π–ª:** `routes/web.php`
- –°—Ç—Ä–æ–∫–∏: 69-75 (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ dashboard)
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–§–∞–π–ª:** `app/Http/Controllers/Auth/LoginController.php`
- –°—Ç—Ä–æ–∫–∏: 38-44 (—Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞)
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Middleware –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (–±–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ –ø–æ—Ä—Ç–∞–ª–∞)

–≠—Ç–∏ middleware –∑–∞—â–∏—â–∞—é—Ç –≤–µ—Å—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ—Ç –¥–æ—Å—Ç—É–ø–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π:

**–§–∞–π–ª—ã:**
- `app/Http/Controllers/Client/Student/*` - –≤—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å—Ç—É–¥–µ–Ω—Ç–∞
- `app/Http/Controllers/Client/Partner/*` - –≤—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–∞—Ä—Ç–Ω–µ—Ä–∞
- `app/Http/Controllers/Admin/CaseController.php` (—Å—Ç—Ä–æ–∫–∞ 25)

**–î–µ–π—Å—Ç–≤–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ Policy/–ø—Ä–∞–≤–∞ –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–æ–≤

---

## üîÑ –ö–∞—Ç–µ–≥–æ—Ä–∏—è 2: –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ –ø—Ä–∞–≤–∞ (–≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å)

–≠—Ç–∏ –º–µ—Å—Ç–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å —Å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤.

### 2.1. Admin –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã - –∑–∞–º–µ–Ω–∏—Ç—å middleware –Ω–∞ –ø—Ä–∞–≤–∞

#### CaseController

**–§–∞–π–ª:** `app/Http/Controllers/Admin/CaseController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```php
$this->middleware(['auth', 'role:admin|teacher']);
```

**–î–µ–π—Å—Ç–≤–∏–µ:** 
1. –£–±—Ä–∞—Ç—å middleware –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –≤ –º–µ—Ç–æ–¥—ã:
   - `index()` ‚Üí `$this->authorize('viewAny', CaseModel::class)` –∏–ª–∏ `permission:cases.view`
   - `create()` ‚Üí `$this->authorize('create', CaseModel::class)` –∏–ª–∏ `permission:cases.create`
   - `store()` ‚Üí `$this->authorize('create', CaseModel::class)` –∏–ª–∏ `permission:cases.create`
   - `show()` ‚Üí `$this->authorize('view', $case)` –∏–ª–∏ `permission:cases.view`
   - `edit()` ‚Üí `$this->authorize('update', $case)` –∏–ª–∏ `permission:cases.update`
   - `update()` ‚Üí `$this->authorize('update', $case)` –∏–ª–∏ `permission:cases.update`
   - `destroy()` ‚Üí `$this->authorize('delete', $case)` –∏–ª–∏ `permission:cases.delete`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

#### UsersController

**–§–∞–π–ª:** `app/Http/Controllers/Admin/UsersController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ù–µ—Ç middleware, –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–∞–≤

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –≤ –º–µ—Ç–æ–¥—ã:
   - `index()` ‚Üí `$this->authorize('viewAny', User::class)` –∏–ª–∏ `permission:users.view`
   - `show()` ‚Üí `$this->authorize('view', $user)` –∏–ª–∏ `permission:users.view`
   - `create()` ‚Üí `$this->authorize('create', User::class)` –∏–ª–∏ `permission:users.create`
   - `store()` ‚Üí `$this->authorize('create', User::class)` –∏–ª–∏ `permission:users.create`
   - `edit()` ‚Üí `$this->authorize('update', $user)` –∏–ª–∏ `permission:users.update`
   - `update()` ‚Üí `$this->authorize('update', $user)` –∏–ª–∏ `permission:users.update`
   - `destroy()` ‚Üí **Policy** (–ø—Ä–æ–≤–µ—Ä–∫–∞ "–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è" + `permission:users.delete`)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

#### SkillController

**–§–∞–π–ª:** `app/Http/Controllers/Admin/SkillController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ï—Å—Ç—å TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –Ω—É–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å `app/Policies/SkillPolicy.php`
2. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –º–µ—Ç–æ–¥–∞—Ö:
   - `index()` ‚Üí `$this->authorize('viewAny', Skill::class)`
   - `store()` ‚Üí `$this->authorize('create', Skill::class)`
   - `update()` ‚Üí `$this->authorize('update', $skill)`
   - `destroy()` ‚Üí `$this->authorize('delete', $skill)`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

#### SimulatorController

**–§–∞–π–ª:** `app/Http/Controllers/Admin/SimulatorController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ï—Å—Ç—å TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –Ω—É–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å `app/Policies/SimulatorPolicy.php`
2. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –º–µ—Ç–æ–¥–∞—Ö:
   - `index()` ‚Üí `$this->authorize('viewAny', Simulator::class)`
   - `store()` ‚Üí `$this->authorize('create', Simulator::class)`
   - `update()` ‚Üí `$this->authorize('update', $simulator)`
   - `destroy()` ‚Üí `$this->authorize('delete', $simulator)`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

#### BadgeController

**–§–∞–π–ª:** `app/Http/Controllers/Admin/BadgeController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** ‚úÖ –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Policy (`BadgePolicy`)

**–î–µ–π—Å—Ç–≤–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `BadgePolicy` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏
- –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏ - –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ –ø—Ä–∞–≤–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

### 2.2. –ú–∞—Ä—à—Ä—É—Ç—ã - –∑–∞–º–µ–Ω–∏—Ç—å role middleware –Ω–∞ permission

**–§–∞–π–ª:** `routes/web.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```php
Route::prefix('admin')->middleware(['auth', 'role:admin|teacher'])
```

**–î–µ–π—Å—Ç–≤–∏–µ:** 
- –û—Å—Ç–∞–≤–∏—Ç—å `role:admin|teacher` –¥–ª—è –±–∞–∑–æ–≤–æ–π –∑–∞—â–∏—Ç—ã –ø–æ—Ä—Ç–∞–ª–∞
- –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–ª—è –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å, –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö)

---

## üõ°Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è 3: –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ Policy (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–º)

–≠—Ç–∏ –º–µ—Å—Ç–∞ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–º –∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Policy.

### 3.1. Partner Cases - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è –∫–µ–π—Å–æ–º

**–§–∞–π–ª:** `app/Http/Controllers/Client/Partner/CasesController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `$this->caseService->ensureCaseBelongsToPartner($case, $partner)`

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å–µ, –∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ Policy

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å `app/Policies/CasePolicy.php` —Å –º–µ—Ç–æ–¥–∞–º–∏:
   ```php
   public function view(User $user, CaseModel $case): bool
   public function update(User $user, CaseModel $case): bool
   public function delete(User $user, CaseModel $case): bool
   public function archive(User $user, CaseModel $case): bool
   public function viewApplications(User $user, CaseModel $case): bool
   public function approveApplication(User $user, CaseModel $case): bool
   public function rejectApplication(User $user, CaseModel $case): bool
   ```

2. –í Policy –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
   - –ê–¥–º–∏–Ω/—É—á–∏—Ç–µ–ª—å ‚Üí –≤—Å–µ–≥–¥–∞ `true` (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–æ)
   - –ü–∞—Ä—Ç–Ω–µ—Ä ‚Üí —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `$case->partner_id === $user->partnerProfile->partner_id`

3. –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `ensureCaseBelongsToPartner` –Ω–∞:
   ```php
   $this->authorize('update', $case);
   ```

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `show()` (—Å—Ç—Ä–æ–∫–∞ 155) ‚Üí `$this->authorize('view', $case)`
- `edit()` (—Å—Ç—Ä–æ–∫–∞ 205) ‚Üí `$this->authorize('update', $case)`
- `update()` (—Å—Ç—Ä–æ–∫–∞ 245) ‚Üí `$this->authorize('update', $case)`
- `archive()` (—Å—Ç—Ä–æ–∫–∞ 271) ‚Üí `$this->authorize('archive', $case)`
- `applications()` (—Å—Ç—Ä–æ–∫–∞ 296) ‚Üí `$this->authorize('viewApplications', $case)`
- `approve()` (—Å—Ç—Ä–æ–∫–∞ 352) ‚Üí `$this->authorize('approveApplication', $case)`
- `reject()` (—Å—Ç—Ä–æ–∫–∞ 388) ‚Üí `$this->authorize('rejectApplication', $case)`
- `exportApplications()` (—Å—Ç—Ä–æ–∫–∞ 424) ‚Üí `$this->authorize('viewApplications', $case)`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

### 3.2. Student Cases - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è –∑–∞—è–≤–∫–æ–π

**–§–∞–π–ª:** `app/Http/Controllers/Client/Student/CasesController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä—É—á–Ω—É—é –≤ –º–µ—Ç–æ–¥–∞—Ö

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å `app/Policies/CaseApplicationPolicy.php` —Å –º–µ—Ç–æ–¥–∞–º–∏:
   ```php
   public function view(User $user, CaseApplication $application): bool
   public function update(User $user, CaseApplication $application): bool
   public function delete(User $user, CaseApplication $application): bool
   public function addTeamMember(User $user, CaseApplication $application): bool
   public function viewTeam(User $user, CaseApplication $application): bool
   ```

2. –í Policy –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
   - –õ–∏–¥–µ—Ä –∑–∞—è–≤–∫–∏ ‚Üí `$application->leader_id === $user->id`
   - –ß–ª–µ–Ω –∫–æ–º–∞–Ω–¥—ã ‚Üí `$application->teamMembers()->where('user_id', $user->id)->exists()`
   - –î–ª—è `addTeamMember` ‚Üí —Ç–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä –∏ —Å—Ç–∞—Ç—É—Å `pending`

3. –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –º–µ—Ç–æ–¥–∞—Ö:
   - `addTeamMember()` (—Å—Ç—Ä–æ–∫–∞ 169) ‚Üí `$this->authorize('addTeamMember', $application)`
   - `withdraw()` (—Å—Ç—Ä–æ–∫–∞ 195) ‚Üí `$this->authorize('delete', $application)`
   - `team()` (—Å—Ç—Ä–æ–∫–∞ 215) ‚Üí `$this->authorize('viewTeam', $application)`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

### 3.3. Notifications - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º

**–§–∞–π–ª:** `app/Http/Controllers/NotificationController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `$notification->user_id !== $user->id`

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å `app/Policies/AppNotificationPolicy.php` —Å –º–µ—Ç–æ–¥–∞–º–∏:
   ```php
   public function view(User $user, AppNotification $notification): bool
   public function update(User $user, AppNotification $notification): bool
   public function delete(User $user, AppNotification $notification): bool
   ```

2. –í Policy –ø—Ä–æ–≤–µ—Ä—è—Ç—å: `$notification->user_id === $user->id`

3. –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –º–µ—Ç–æ–¥–∞—Ö:
   - `markAsRead()` (—Å—Ç—Ä–æ–∫–∞ 66) ‚Üí `$this->authorize('update', $notification)`
   - `destroy()` (—Å—Ç—Ä–æ–∫–∞ 103) ‚Üí `$this->authorize('delete', $notification)`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

### 3.4. Users - –ø—Ä–æ–≤–µ—Ä–∫–∞ "–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è"

**–§–∞–π–ª:** `app/Http/Controllers/Admin/UsersController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `$user->id === auth()->id()` –≤ –º–µ—Ç–æ–¥–µ `destroy()`

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å `app/Policies/UserPolicy.php` —Å –º–µ—Ç–æ–¥–æ–º:
   ```php
   public function delete(User $user, User $targetUser): bool
   {
       // –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è
       if ($user->id === $targetUser->id) {
           return false;
       }
       
       // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
       return $user->hasPermissionTo('users.delete');
   }
   ```

2. –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `destroy()` (—Å—Ç—Ä–æ–∫–∞ 256):
   ```php
   $this->authorize('delete', $user);
   ```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

### 3.5. Simulator Sessions - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π

**–§–∞–π–ª:** `app/Http/Controllers/Client/Student/SimulatorsController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `$session->user_id !== $user->id`

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å `app/Policies/SimulatorSessionPolicy.php` —Å –º–µ—Ç–æ–¥–∞–º–∏:
   ```php
   public function view(User $user, SimulatorSession $session): bool
   public function update(User $user, SimulatorSession $session): bool
   ```

2. –í Policy –ø—Ä–æ–≤–µ—Ä—è—Ç—å: `$session->user_id === $user->id`

3. –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –º–µ—Ç–æ–¥–∞—Ö:
   - `session()` (—Å—Ç—Ä–æ–∫–∞ 82) ‚Üí `$this->authorize('view', $session)`
   - `complete()` (—Å—Ç—Ä–æ–∫–∞ 102) ‚Üí `$this->authorize('update', $session)`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

### 3.6. Partner Teams - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è –∫–µ–π—Å–æ–º

**–§–∞–π–ª:** `app/Http/Controllers/Client/Partner/TeamController.php`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ensureCaseBelongsToPartner`

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CasePolicy` (—Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤ –ø. 3.1)
2. –ó–∞–º–µ–Ω–∏—Ç—å `ensureCaseBelongsToPartner` –Ω–∞ `$this->authorize('view', $application->case)`

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `show()` (—Å—Ç—Ä–æ–∫–∞ 95) ‚Üí `$this->authorize('view', $application->case)`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

---

## üìù –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: CasePolicy

```php
<?php

declare(strict_types=1);

namespace App\Policies;

use App\Models\CaseModel;
use App\Models\User;

class CasePolicy
{
    /**
     * Determine whether the user can view any models.
     */
    public function viewAny(User $user): bool
    {
        return $user->hasPermissionTo('cases.view');
    }

    /**
     * Determine whether the user can view the model.
     */
    public function view(User $user, CaseModel $case): bool
    {
        // –ê–¥–º–∏–Ω –∏ —É—á–∏—Ç–µ–ª—å –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –≤—Å–µ (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–æ)
        if ($user->hasAnyRole(['admin', 'teacher'])) {
            return $user->hasPermissionTo('cases.view');
        }

        // –ü–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–µ–π—Å—ã
        if ($user->hasRole('partner')) {
            return $user->partnerProfile?->partner_id === $case->partner_id;
        }

        // –°—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–µ–π—Å—ã
        if ($user->hasRole('student')) {
            return $case->status === 'active';
        }

        return false;
    }

    /**
     * Determine whether the user can create models.
     */
    public function create(User $user): bool
    {
        return $user->hasPermissionTo('cases.create');
    }

    /**
     * Determine whether the user can update the model.
     */
    public function update(User $user, CaseModel $case): bool
    {
        // –ê–¥–º–∏–Ω –∏ —É—á–∏—Ç–µ–ª—å –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–æ)
        if ($user->hasAnyRole(['admin', 'teacher'])) {
            return $user->hasPermissionTo('cases.update');
        }

        // –ü–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–µ–π—Å—ã
        if ($user->hasRole('partner')) {
            return $user->partnerProfile?->partner_id === $case->partner_id
                && $user->hasPermissionTo('cases.update');
        }

        return false;
    }

    /**
     * Determine whether the user can delete the model.
     */
    public function delete(User $user, CaseModel $case): bool
    {
        // –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–æ)
        if ($user->hasRole('admin')) {
            return $user->hasPermissionTo('cases.delete');
        }

        return false;
    }

    /**
     * Determine whether the user can archive the model.
     */
    public function archive(User $user, CaseModel $case): bool
    {
        // –ê–¥–º–∏–Ω –∏ —É—á–∏—Ç–µ–ª—å –º–æ–≥—É—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ
        if ($user->hasAnyRole(['admin', 'teacher'])) {
            return $user->hasPermissionTo('cases.update');
        }

        // –ü–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–µ–π—Å—ã
        if ($user->hasRole('partner')) {
            return $user->partnerProfile?->partner_id === $case->partner_id
                && $user->hasPermissionTo('cases.update');
        }

        return false;
    }

    /**
     * Determine whether the user can view applications for the case.
     */
    public function viewApplications(User $user, CaseModel $case): bool
    {
        // –ê–¥–º–∏–Ω –∏ —É—á–∏—Ç–µ–ª—å –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏
        if ($user->hasAnyRole(['admin', 'teacher'])) {
            return $user->hasPermissionTo('cases.view');
        }

        // –ü–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∑–∞—è–≤–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–≤–æ–∏ –∫–µ–π—Å—ã
        if ($user->hasRole('partner')) {
            return $user->partnerProfile?->partner_id === $case->partner_id;
        }

        return false;
    }

    /**
     * Determine whether the user can approve applications.
     */
    public function approveApplication(User $user, CaseModel $case): bool
    {
        // –ê–¥–º–∏–Ω –∏ —É—á–∏—Ç–µ–ª—å –º–æ–≥—É—Ç –æ–¥–æ–±—Ä—è—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—Å–µ –∫–µ–π—Å—ã
        if ($user->hasAnyRole(['admin', 'teacher'])) {
            return $user->hasPermissionTo('cases.approve');
        }

        // –ü–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä—è—Ç—å –∑–∞—è–≤–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–≤–æ–∏ –∫–µ–π—Å—ã
        if ($user->hasRole('partner')) {
            return $user->partnerProfile?->partner_id === $case->partner_id
                && $user->hasPermissionTo('cases.approve');
        }

        return false;
    }

    /**
     * Determine whether the user can reject applications.
     */
    public function rejectApplication(User $user, CaseModel $case): bool
    {
        // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ approveApplication
        return $this->approveApplication($user, $case);
    }
}
```

### –ü—Ä–∏–º–µ—Ä 2: CaseApplicationPolicy

```php
<?php

declare(strict_types=1);

namespace App\Policies;

use App\Models\CaseApplication;
use App\Models\User;

class CaseApplicationPolicy
{
    /**
     * Determine whether the user can view the application.
     */
    public function view(User $user, CaseApplication $application): bool
    {
        // –õ–∏–¥–µ—Ä –∑–∞—è–≤–∫–∏
        if ($application->leader_id === $user->id) {
            return true;
        }

        // –ß–ª–µ–Ω –∫–æ–º–∞–Ω–¥—ã
        if ($application->teamMembers()->where('user_id', $user->id)->exists()) {
            return true;
        }

        // –ü–∞—Ä—Ç–Ω–µ—Ä, –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–µ–π—Å
        if ($user->hasRole('partner')) {
            return $user->partnerProfile?->partner_id === $application->case->partner_id;
        }

        // –ê–¥–º–∏–Ω –∏ —É—á–∏—Ç–µ–ª—å
        if ($user->hasAnyRole(['admin', 'teacher'])) {
            return $user->hasPermissionTo('cases.view');
        }

        return false;
    }

    /**
     * Determine whether the user can update the application.
     */
    public function update(User $user, CaseApplication $application): bool
    {
        // –¢–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞—è–≤–∫—É
        return $application->leader_id === $user->id
            && $application->status->name === 'pending';
    }

    /**
     * Determine whether the user can delete the application.
     */
    public function delete(User $user, CaseApplication $application): bool
    {
        // –¢–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä –º–æ–∂–µ—Ç –æ—Ç–æ–∑–≤–∞—Ç—å –∑–∞—è–≤–∫—É
        return $application->leader_id === $user->id
            && $application->status->name === 'pending';
    }

    /**
     * Determine whether the user can add team members.
     */
    public function addTeamMember(User $user, CaseApplication $application): bool
    {
        // –¢–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        return $application->leader_id === $user->id
            && $application->status->name === 'pending';
    }

    /**
     * Determine whether the user can view the team.
     */
    public function viewTeam(User $user, CaseApplication $application): bool
    {
        // –õ–∏–¥–µ—Ä –∏–ª–∏ —á–ª–µ–Ω –∫–æ–º–∞–Ω–¥—ã
        if ($application->leader_id === $user->id) {
            return true;
        }

        if ($application->teamMembers()->where('user_id', $user->id)->exists()) {
            return true;
        }

        // –ü–∞—Ä—Ç–Ω–µ—Ä, –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–µ–π—Å
        if ($user->hasRole('partner')) {
            return $user->partnerProfile?->partner_id === $application->case->partner_id;
        }

        // –ê–¥–º–∏–Ω –∏ —É—á–∏—Ç–µ–ª—å
        if ($user->hasAnyRole(['admin', 'teacher'])) {
            return $user->hasPermissionTo('cases.view');
        }

        return false;
    }
}
```

### –ü—Ä–∏–º–µ—Ä 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ

**–î–æ:**
```php
public function update(UpdateRequest $request, CaseModel $case): RedirectResponse
{
    $user = auth()->user();
    $partner = $user->partner;

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
    $this->caseService->ensureCaseBelongsToPartner($case, $partner);

    // –û–±–Ω–æ–≤–∏—Ç—å –∫–µ–π—Å
    $this->caseService->updateCase($case, $request->validated());

    return redirect()
        ->route('partner.cases.show', $case)
        ->with('success', '–ö–µ–π—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω');
}
```

**–ü–æ—Å–ª–µ:**
```php
public function update(UpdateRequest $request, CaseModel $case): RedirectResponse
{
    // Policy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–ª–∞–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–º
    $this->authorize('update', $case);

    // –û–±–Ω–æ–≤–∏—Ç—å –∫–µ–π—Å
    $this->caseService->updateCase($case, $request->validated());

    return redirect()
        ->route('partner.cases.show', $case)
        ->with('success', '–ö–µ–π—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω');
}
```

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–º)

1. **CasePolicy** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Partner/CasesController (–º–Ω–æ–≥–æ –º–µ—Å—Ç)
2. **UserPolicy** - –ø—Ä–æ–≤–µ—Ä–∫–∞ "–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è"
3. **CaseApplicationPolicy** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Student/CasesController
4. **Admin –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã** - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –≤ CaseController –∏ UsersController

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

1. **SkillPolicy** - —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ SkillController
2. **SimulatorPolicy** - —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ SimulatorController
3. **AppNotificationPolicy** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
4. **SimulatorSessionPolicy** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π
5. **Partner Teams** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CasePolicy

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

1. **BadgePolicy** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∞, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏
2. **–ú–∞—Ä—à—Ä—É—Ç—ã** - –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å role middleware, –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Policies

- [ ] `app/Policies/CasePolicy.php`
- [ ] `app/Policies/CaseApplicationPolicy.php`
- [ ] `app/Policies/UserPolicy.php`
- [ ] `app/Policies/SkillPolicy.php`
- [ ] `app/Policies/SimulatorPolicy.php`
- [ ] `app/Policies/AppNotificationPolicy.php`
- [ ] `app/Policies/SimulatorSessionPolicy.php`

### –®–∞–≥ 2: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å Policies

- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `app/Providers/AuthServiceProvider.php`:
  ```php
  protected $policies = [
      CaseModel::class => CasePolicy::class,
      CaseApplication::class => CaseApplicationPolicy::class,
      User::class => UserPolicy::class,
      Skill::class => SkillPolicy::class,
      Simulator::class => SimulatorPolicy::class,
      AppNotification::class => AppNotificationPolicy::class,
      SimulatorSession::class => SimulatorSessionPolicy::class,
  ];
  ```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

- [ ] `app/Http/Controllers/Client/Partner/CasesController.php` - –∑–∞–º–µ–Ω–∏—Ç—å `ensureCaseBelongsToPartner` –Ω–∞ `authorize()`
- [ ] `app/Http/Controllers/Client/Student/CasesController.php` - –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ `authorize()`
- [ ] `app/Http/Controllers/Admin/CaseController.php` - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
- [ ] `app/Http/Controllers/Admin/UsersController.php` - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∏ Policy
- [ ] `app/Http/Controllers/Admin/SkillController.php` - —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] `app/Http/Controllers/Admin/SimulatorController.php` - —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] `app/Http/Controllers/NotificationController.php` - –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ `authorize()`
- [ ] `app/Http/Controllers/Client/Student/SimulatorsController.php` - –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ `authorize()`
- [ ] `app/Http/Controllers/Client/Partner/TeamController.php` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CasePolicy

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å BadgePolicy

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `app/Policies/BadgePolicy.php` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–∏ –ø—Ä–∞–≤–∞ –∏–ª–∏ —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏
- [ ] –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏ - –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –Ω–∞ –ø—Ä–∞–≤–∞

### –®–∞–≥ 5: –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥

- [ ] –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–æ–¥ `ensureCaseBelongsToPartner` –∏–∑ `CaseService`
- [ ] –£–¥–∞–ª–∏—Ç—å —Ä—É—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–º –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö Policies
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É—á–∏—Ç–µ–ª—å –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞—Ä—Ç–Ω–µ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–µ–π—Å—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –∑–∞—è–≤–∫–∞–º–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü—Ä–∞–≤–∞ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã** –≤ `database/seeders/PermissionSeeder.php` - –∏—Ö –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
2. **BadgePolicy —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. **TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** –≤ SkillController –∏ SimulatorController —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å Policy
4. **–ú–µ—Ç–æ–¥ ensureCaseBelongsToPartner** –≤ CaseService –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ Policy

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Laravel Authorization Documentation](https://laravel.com/docs/10.x/authorization)
- [Spatie Permission Documentation](https://spatie.be/docs/laravel-permission/v6/introduction)
- [Laravel Policies Best Practices](https://laravel.com/docs/10.x/authorization#policy-methods)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024
**–°—Ç–∞—Ç—É—Å:** –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

