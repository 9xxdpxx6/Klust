<template>
    <PublicLayout>
        <Head title="Как это работает" />
        <!-- Hero Section -->
        <section class="bg-gradient-to-br from-primary to-primary-dark text-white py-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h1 class="text-4xl md:text-5xl font-extrabold mb-4">
                    Как это работает
                </h1>
                <p class="text-xl text-white/90">
                    Пошаговое руководство для студентов по работе на платформе
                </p>
            </div>
        </section>

        <!-- Steps Section -->
        <section class="py-16 bg-kubgtu-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-text-primary mb-4">
                        Процесс работы на платформе
                    </h2>
                    <p class="text-lg text-text-secondary max-w-2xl mx-auto">
                        От регистрации до завершения проекта - все просто и понятно
                    </p>
                </div>

                <div class="space-y-8">
                    <!-- Step 1 -->
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold">
                                1
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-semibold text-text-primary mb-3">
                                Регистрация и создание профиля
                            </h3>
                            <p class="text-text-secondary mb-4">
                                Зарегистрируйтесь на платформе, указав свои данные: факультет, курс, группу и специальность. 
                                Заполните профиль, добавьте свои навыки и интересы. Это поможет системе рекомендовать вам 
                                подходящие кейсы.
                            </p>
                            <div class="bg-surface rounded-lg p-4 border border-border-light">
                                <p class="text-sm text-text-secondary">
                                    <strong class="text-text-primary">Совет:</strong> Чем полнее ваш профиль, тем точнее будут рекомендации кейсов, 
                                    которые подходят именно вам.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold">
                                2
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-semibold text-text-primary mb-3">
                                Выбор кейса
                            </h3>
                            <p class="text-text-secondary mb-4">
                                Просмотрите каталог активных кейсов от партнеров-компаний. Каждый кейс содержит описание проекта, 
                                требуемые навыки, размер команды и дедлайн. Используйте фильтры для поиска кейсов, которые 
                                соответствуют вашим интересам и навыкам.
                            </p>
                            <div class="bg-surface rounded-lg p-4 border border-border-light">
                                <p class="text-sm text-text-secondary">
                                    <strong class="text-text-primary">Совет:</strong> Обратите внимание на раздел "Рекомендуемые кейсы" - 
                                    там собраны проекты, которые лучше всего подходят именно вам.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold">
                                3
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-semibold text-text-primary mb-3">
                                Подача заявки
                            </h3>
                            <p class="text-text-secondary mb-4">
                                Выберите кейс и подайте заявку в качестве лидера команды. Укажите мотивацию и почему вы 
                                подходите для этого проекта. После этого вы сможете добавить участников в свою команду 
                                (до указанного в кейсе размера команды).
                            </p>
                            <div class="bg-surface rounded-lg p-4 border border-border-light">
                                <p class="text-sm text-text-secondary">
                                    <strong class="text-text-primary">Важно:</strong> Вы можете быть лидером только одной активной заявки 
                                    одновременно. Убедитесь, что выбрали проект, который действительно вас интересует.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4 -->
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold">
                                4
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-semibold text-text-primary mb-3">
                                Формирование команды
                            </h3>
                            <p class="text-text-secondary mb-4">
                                Пригласите других студентов в свою команду. Вы можете искать студентов по имени, факультету 
                                или навыкам. Каждый участник команды получит уведомление и сможет принять или отклонить 
                                приглашение.
                            </p>
                            <div class="bg-surface rounded-lg p-4 border border-border-light">
                                <p class="text-sm text-text-secondary">
                                    <strong class="text-text-primary">Совет:</strong> Соберите команду с разными навыками - это повысит 
                                    шансы на успешное выполнение проекта.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5 -->
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold">
                                5
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-semibold text-text-primary mb-3">
                                Рассмотрение заявки партнером
                            </h3>
                            <p class="text-text-secondary mb-4">
                                Партнер-компания рассмотрит вашу заявку и примет решение: принять или отклонить. Вы получите 
                                уведомление о решении. Если заявка принята, вы и ваша команда получите доступ к рабочему 
                                пространству проекта.
                            </p>
                            <div class="bg-surface rounded-lg p-4 border border-border-light">
                                <p class="text-sm text-text-secondary">
                                    <strong class="text-text-primary">Важно:</strong> Партнер может оставить комментарий к решению. 
                                    Если заявка отклонена, не расстраивайтесь - попробуйте подать заявку на другой кейс.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 6 -->
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold">
                                6
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-semibold text-text-primary mb-3">
                                Работа над проектом
                            </h3>
                            <p class="text-text-secondary mb-4">
                                После одобрения заявки начинается работа над проектом. Используйте рабочее пространство 
                                для общения с командой, отслеживания прогресса и взаимодействия с партнером. Выполняйте 
                                задачи в срок и следите за дедлайнами.
                            </p>
                            <div class="bg-surface rounded-lg p-4 border border-border-light">
                                <p class="text-sm text-text-secondary">
                                    <strong class="text-text-primary">Совет:</strong> Регулярно обновляйте прогресс проекта и 
                                    общайтесь с партнером - это поможет избежать недопониманий.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 7 -->
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold">
                                7
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-semibold text-text-primary mb-3">
                                Завершение и получение наград
                            </h3>
                            <p class="text-text-secondary mb-4">
                                После успешного завершения проекта вы и ваша команда получите очки навыков, которые помогут 
                                прокачать ваш профиль. При достижении определенных порогов вы автоматически получите бейджи 
                                за достижения. Все это отображается в вашем профиле и помогает строить профессиональное портфолио.
                            </p>
                            <div class="bg-surface rounded-lg p-4 border border-border-light">
                                <p class="text-sm text-text-secondary">
                                    <strong class="text-text-primary">Бонус:</strong> Завершенные проекты добавляются в ваше портфолио, 
                                    которое можно показать будущим работодателям.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="py-16 bg-surface">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-text-primary mb-4">
                        Часто задаваемые вопросы
                    </h2>
                    <p class="text-lg text-text-secondary">
                        Ответы на популярные вопросы студентов
                    </p>
                </div>

                <div class="space-y-4">
                    <div
                        v-for="(faq, index) in faqs"
                        :key="index"
                        class="bg-kubgtu-white rounded-xl shadow-sm border border-border-light overflow-hidden transition-all duration-300 hover:shadow-md"
                    >
                        <button
                            @click="toggleFaq(index)"
                            class="w-full px-6 py-4 text-left flex items-center justify-between hover:bg-surface transition-colors duration-200"
                        >
                            <h3 class="text-lg font-semibold text-text-primary pr-4">
                                {{ faq.question }}
                            </h3>
                            <svg
                                class="w-5 h-5 text-primary flex-shrink-0 transition-transform duration-300 ease-in-out"
                                :class="{ 'rotate-180': openFaqs[index] }"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <Transition name="faq-slide">
                            <div
                                v-if="openFaqs[index]"
                                class="faq-content px-6 pb-4 text-text-secondary"
                            >
                                <p class="whitespace-pre-line">{{ faq.answer }}</p>
                            </div>
                        </Transition>
                    </div>
                </div>
            </div>
        </section>

        <!-- Example Cases Section -->
        <section v-if="exampleCases.length > 0" class="py-16 bg-kubgtu-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-text-primary mb-4">
                        Примеры успешных проектов
                    </h2>
                    <p class="text-lg text-text-secondary max-w-2xl mx-auto">
                        Реальные кейсы, которые уже были успешно завершены студентами
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div
                        v-for="caseItem in exampleCases"
                        :key="caseItem.id"
                        class="bg-surface rounded-xl shadow-sm border border-border-light p-6 hover:shadow-lg transition-shadow"
                    >
                        <div class="mb-4">
                            <h3 class="text-xl font-semibold text-text-primary mb-2">
                                {{ caseItem.title }}
                            </h3>
                            <p class="text-text-secondary text-sm line-clamp-3">
                                {{ caseItem.description }}
                            </p>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-4">
                            <span
                                v-for="skill in caseItem.skills.slice(0, 3)"
                                :key="skill.id"
                                class="px-2 py-1 text-xs font-medium bg-primary/10 text-primary rounded"
                            >
                                {{ skill.name }}
                            </span>
                            <span
                                v-if="caseItem.skills.length > 3"
                                class="px-2 py-1 text-xs font-medium bg-gray-100 text-text-secondary rounded"
                            >
                                +{{ caseItem.skills.length - 3 }}
                            </span>
                        </div>

                        <div class="flex items-center gap-2 text-sm text-text-secondary">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                            </svg>
                            <span>{{ getPartnerName(caseItem) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="py-16 bg-gradient-to-br from-primary to-primary-dark text-white">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-4">
                    Готовы начать?
                </h2>
                <p class="text-xl text-white/90 mb-8">
                    Зарегистрируйтесь на платформе и начните работу над реальными проектами уже сегодня
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <Link
                        :href="route('register')"
                        class="inline-flex px-8 py-4 bg-white text-primary rounded-lg hover:bg-gray-100 transition-colors text-lg font-semibold shadow-lg"
                    >
                        Зарегистрироваться
                    </Link>
                    <Link
                        :href="route('guest.cases')"
                        class="inline-flex px-8 py-4 bg-transparent border-2 border-white text-white rounded-lg hover:bg-white/10 transition-colors text-lg font-semibold"
                    >
                        Посмотреть кейсы
                    </Link>
                </div>
            </div>
        </section>
    </PublicLayout>
</template>

<script setup>
import { ref, computed } from 'vue'
import { Head, Link } from '@inertiajs/vue3'
import { route } from 'ziggy-js'
import PublicLayout from '@/Layouts/PublicLayout.vue'

const props = defineProps({
    exampleCases: {
        type: Array,
        default: () => [],
    },
})

const openFaqs = ref({})

const toggleFaq = (index) => {
    openFaqs.value[index] = !openFaqs.value[index]
}

const faqs = [
    {
        question: 'Сколько кейсов я могу выполнить одновременно?',
        answer: 'Вы можете быть лидером только одной активной заявки одновременно. Однако вы можете участвовать в других командах как участник (не лидер). После завершения или отмены заявки вы сможете подать новую.'
    },
    {
        question: 'Что делать, если моя заявка отклонена?',
        answer: 'Не расстраивайтесь! Партнер может оставить комментарий с объяснением. Проанализируйте обратную связь, улучшите свой профиль и попробуйте подать заявку на другой кейс. Помните, что отказ по одному проекту не означает, что другие проекты вам не подходят.'
    },
    {
        question: 'Как формировать команду?',
        answer: 'После подачи заявки вы сможете пригласить других студентов в свою команду. Вы можете искать их по имени, факультету или навыкам. Каждый участник получит уведомление и сможет принять или отклонить приглашение. Размер команды ограничен требованиями кейса.'
    },
    {
        question: 'Что такое бейджи и как их получить?',
        answer: 'Бейджи - это достижения, которые вы получаете за различные активности на платформе. Например, за завершение определенного количества кейсов, достижение определенного уровня навыков или участие в симуляторах. Бейджи автоматически добавляются в ваш профиль при выполнении условий.'
    },
    {
        question: 'Как работают навыки и очки?',
        answer: 'За выполнение кейсов и участие в симуляторах вы получаете очки навыков. Эти очки повышают уровень ваших навыков в профиле. Чем выше уровень навыка, тем больше вы показываете свой профессионализм в этой области.'
    },
    {
        question: 'Могу ли я отменить заявку?',
        answer: 'Да, вы можете отозвать свою заявку до того, как партнер примет решение. После одобрения заявки отмена возможна только в особых случаях - свяжитесь с администрацией платформы.'
    },
    {
        question: 'Что такое симуляторы?',
        answer: 'Симуляторы - это интерактивные обучающие модули, которые помогают развивать навыки в различных областях. За прохождение симуляторов вы получаете очки навыков и можете заработать бейджи.'
    },
    {
        question: 'Как связаться с партнером?',
        answer: 'После одобрения вашей заявки вы получите доступ к рабочему пространству проекта, где сможете общаться с партнером и командой. Все коммуникации проходят через платформу для удобства и безопасности.'
    }
]

const getPartnerName = (caseItem) => {
    // partner уже является PartnerProfile, проверяем company_name напрямую
    if (caseItem.partner?.company_name) {
        return caseItem.partner.company_name
    }
    // Если нет company_name, проверяем через user
    if (caseItem.partner?.user?.partnerProfile?.company_name) {
        return caseItem.partner.user.partnerProfile.company_name
    }
    if (caseItem.partner?.user?.name) {
        return caseItem.partner.user.name
    }
    return 'Партнер'
}
</script>

<style scoped>
.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* FAQ Slide Animation */
.faq-content {
    overflow: hidden;
    display: block;
}

.faq-slide-enter-active {
    transition: max-height 0.3s ease-out, opacity 0.3s ease-out, padding 0.3s ease-out;
    overflow: hidden;
}

.faq-slide-leave-active {
    transition: max-height 0.3s ease-in, opacity 0.25s ease-in, padding 0.3s ease-in;
    overflow: hidden;
}

.faq-slide-enter-from {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
}

.faq-slide-enter-to {
    max-height: 2000px;
    opacity: 1;
}

.faq-slide-leave-from {
    max-height: 2000px;
    opacity: 1;
}

.faq-slide-leave-to {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
}
</style>

